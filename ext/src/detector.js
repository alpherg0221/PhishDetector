import{a as S,b as v,h as c,L as r}from"../assets/utils.js";chrome.runtime.onMessage.addListener((t,i,n)=>{switch(t.type){case"detection":return l().then(a=>n(a)),!0}});const l=async t=>{const i=await S(),n=await v(),a=await c(r.Allow),s=await c(r.Block),e=await c(r.Tmp).then(x=>x.map(b=>b.split("@")[0]));if(n&&a.includes(location.hostname))return{resFlag:"Safe",url:location.hostname,time:"0",detectBy:"List"};if(i&&s.includes(location.hostname))return{resFlag:"Phish",url:location.hostname,time:"0",detectBy:"List"};if(e.includes(location.hostname))return{resFlag:"_Phish",url:location.hostname,time:"0",detectBy:"List"};const o=3,m=performance.now()/1e3;let d="NoPasswordForm";await I()||console.log("PhishDetector:NoPasswordForm");const h=await T(),f=await q(),g=await F(),k=await C(),y=await H(),p=await P(),w=await W(),L=await O(),_=await B(),A=await E(),$=await N();return{resFlag:d,url:location.hostname,time:(performance.now()/1e3-m).toFixed(o),detectBy:"RealTime",copied:h,ga:f,script:g,extLink:k,noTitle:y,samePageLink:p,iframe:w,tagCountInHead:L,noDomainInInternalLink:_,invalidKiyaku:A,ipAddressInLink:$}},I=async()=>{let t=document.querySelectorAll('input[type="password"]').length;const i=document.querySelectorAll("iframe");for(const n of i)try{t+=n.contentWindow.document.querySelectorAll('input[type="password"]').length}catch{}return t>=1},u=async t=>{t.detectBy==="List"?location.assign(`chrome-extension://${chrome.runtime.id}/src/warning/index.html
      ?url=${t.url}
      &resFlag=${t.resFlag}
      &time=${t.time}`):t.detectBy==="RealTime"&&location.assign(`chrome-extension://${chrome.runtime.id}/src/warning/index.html
      ?url=${t.url}
      &resFlag=${t.resFlag}
      &time=${t.time}
      &ga=${t.ga}
      &copied=${t.copied}
      &script=${t.script}
      &extLink=${t.extLink}
      &noTitle=${t.noTitle}
      &samePageLink=${t.samePageLink}
      &iframe=${t.iframe}
      &tagCountInHead=${t.tagCountInHead}
      &noDomainInInternalLink=${t.noDomainInInternalLink}
      &invalidKiyaku=${t.invalidKiyaku}
      &ipAddressInLink=${t.ipAddressInLink}`)},T=async()=>document.documentElement.hasAttribute("data-scrapbook-source")||document.documentElement.outerHTML.includes("saved from url")?1:0,q=async()=>{const t="https://www.google-analytics.com/analytics.js",i="https://www.googletagmanager.com/gtag/js",n=document.documentElement.outerHTML;return n.includes(t)||n.includes(i)?1:0},F=async()=>{let t=document.querySelectorAll("script").length;const i=document.querySelectorAll("iframe");for(const n of i)try{t+=n.contentWindow.document.querySelectorAll("script").length}catch{}return t},C=async()=>{const t=Array.from(document.querySelectorAll("a[href]")),i=document.querySelectorAll("iframe");for(const s of i)try{t.push(...s.contentWindow.document.querySelectorAll("a[href]"))}catch{}let n=0,a=0;for(const s of t){let e=s.getAttribute("href");if(!(e===""||e.startsWith("#")))if(e.startsWith("http")||e.startsWith("//")){e.startsWith("//")&&(e=`${location.protocol}${e}`);let o=new URL(e).hostname;for(;document.cookie=`pd_test_key=pd_test_value; domain=${o};`,o.indexOf(".")!==-1;)o=o.substring(o.indexOf(".")+1);for(document.cookie.includes("pd_test_key=pd_test_value")?(a++,console.log(`internal : ${e}`)):(n++,console.log(`external : ${e}`)),o=new URL(e).hostname;document.cookie=`pd_test_key=pd_test_value; domain=${o}; max-age=0;`,o.indexOf(".")!==-1;)o=o.substring(o.indexOf(".")+1)}else a++}return n+a>=0?n*100/(n+a):0},H=async()=>{let t=document.querySelector("title");return t===null||t.text===""?1:0},P=async()=>{const t=["","#","#nothing","#null","#void","#doesnotexist","#whatever"],i=[...document.querySelectorAll("a[href]")].map(s=>s.href),n={};for(const s in i)t.includes(s.toLowerCase())||s.toLowerCase().startsWith("javascript")||(n[s]=(n[s]||0)+1);let a=-1;for(const s of i)a<n[s]&&(a=n[s]);return a},W=async()=>document.querySelectorAll("iframe").length,O=async()=>document.querySelector("head").childElementCount,B=async()=>{const t=[...document.querySelectorAll("*[href]")].map(e=>e.href),i=[...document.querySelectorAll("*[src]")].map(e=>e.getAttribute("src")),n=[...t,...i];let a=0,s=0;for(let e of n)if(e.startsWith("http")||e.startsWith("//")){e.startsWith("//")&&(e=`${location.protocol}${e}`);let o=new URL(e).hostname;for(;document.cookie=`pd_test_key=pd_test_value; domain=${o};`,o.indexOf(".")!==-1;)o=o.substring(o.indexOf(".")+1);for(document.cookie.includes("pd_test_key=pd_test_value")&&a++,o=new URL(e).hostname;document.cookie=`pd_test_key=pd_test_value; domain=${o}; max-age=0;`,o.indexOf(".")!==-1;)o=o.substring(o.indexOf(".")+1)}else a++,s++;return a>=0?s/a:0},E=async()=>{const t=[...document.querySelectorAll("a")].filter(n=>n.text.includes("規約")||n.text.includes("プライバシーポリシー")),i=t.filter(n=>n.hasAttribute("href")).filter(n=>!n.href.startsWith("#"));return t.length===i.length?1:0},N=async()=>{const t=/^.*((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).*$/g,i=[...document.querySelectorAll("*[href]")].map(e=>e.href),n=[...document.querySelectorAll("*[src]")].map(e=>e.getAttribute("src"));return[...i,...n].map(e=>t.test(e)).length>0?1:0},R=()=>{const t=document.documentElement,i={childList:!0,subtree:!0};new MutationObserver(a=>{a.forEach(s=>{s.addedNodes.forEach(e=>{e.nodeName.toLowerCase()==="input"&&e.type==="password"&&l().then(async o=>{o.resFlag==="Phish"&&await u(o)})})})}).observe(t,i)};R();l().then(async t=>{t.resFlag==="Phish"&&await u(t)}).catch(t=>console.error(t));
