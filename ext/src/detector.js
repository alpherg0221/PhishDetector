import{a as k,b as L,h,L as f}from"../assets/utils.js";chrome.runtime.onMessage.addListener((e,n,s)=>{switch(e.type){case"detection":return p(!0).then(i=>s(i)),!0}});const x=e=>new Promise(n=>setTimeout(n,e)),p=async e=>{const n=await k(),s=await L(),i=await h(f.Allow),a=await h(f.Block),o=await h(f.Tmp).then(g=>g.map(y=>y.split("@")[0]));if(s&&i.includes(location.hostname))return{resFlag:"Safe",url:location.hostname,ga:!1,copied:!1,script:0,extLink:0,time:"0",detectBy:"List"};if(n&&a.includes(location.hostname))return{resFlag:"Phish",url:location.hostname,ga:!1,copied:!1,script:0,extLink:0,time:"0",detectBy:"List"};if(o.includes(location.hostname))return{resFlag:"_Phish",url:location.hostname,ga:!1,copied:!1,script:0,extLink:0,time:"0",detectBy:"List"};const t=3,r=performance.now()/1e3;let c="Unknown",l,m,d,u;return e||await x(2e3),await F()||(console.log(`PhishDetector:NoPasswordForm:${(performance.now()/1e3-r).toFixed(t)}`),c="NoPasswordForm"),l=await P(),l&&(c!=="NoPasswordForm"&&(c="Safe"),console.log(`PhishDetector:GA:${(performance.now()/1e3-r).toFixed(t)}`)),m=await A(),m&&(c!=="NoPasswordForm"&&(c="Phish"),console.log(`PhishDetector:Copy:${(performance.now()/1e3-r).toFixed(t)}`)),d=await _(),d<=11&&(c!=="NoPasswordForm"&&(c="Phish"),console.log(`PhishDetector:Script:${(performance.now()/1e3-r).toFixed(t)}`)),u=await $(),u>=64&&(c!=="NoPasswordForm"&&(c="Phish"),console.log(`PhishDetector:ExtLink:${(performance.now()/1e3-r).toFixed(t)}`)),{resFlag:c,url:location.hostname,ga:l,copied:m,script:d,extLink:u,time:(performance.now()/1e3-r).toFixed(t),detectBy:"Indicator"}},F=async()=>{let e=document.querySelectorAll('input[type="password"]').length;const n=document.querySelectorAll("iframe");for(const s of n)try{e+=s.contentWindow.document.querySelectorAll('input[type="password"]').length}catch{}return e>=1},w=async(e,n,s,i,a,o,t)=>{location.assign(`chrome-extension://${chrome.runtime.id}/src/warning/index.html?url=${location.hostname}&resFlag=${e}&detectBy=${n}&ga=${s}&copied=${i}&script=${a}&extLink=${o}&time=${t}`)},P=async()=>{const e="https://www.google-analytics.com/analytics.js",n="https://www.googletagmanager.com/gtag/js",s=document.documentElement.outerHTML;return s.includes(e)||s.includes(n)},A=async()=>document.documentElement.hasAttribute("data-scrapbook-source")||document.documentElement.outerHTML.includes("saved from url"),_=async()=>{let e=document.querySelectorAll("script").length;const n=document.querySelectorAll("iframe");for(const s of n)try{e+=s.contentWindow.document.querySelectorAll("script").length}catch{}return e},$=async()=>{const e=Array.from(document.querySelectorAll("a[href]")),n=document.querySelectorAll("iframe");for(const a of n)try{e.push(...a.contentWindow.document.querySelectorAll("a[href]"))}catch{}let s=0,i=0;for(const a of e){let o=a.getAttribute("href");if(!(o===""||o.startsWith("#")))if(o.startsWith("http")||o.startsWith("//")){o.startsWith("//")&&(o=`${location.protocol}${o}`);let t=new URL(o).hostname;for(;document.cookie=`pd_test_key=pd_test_value; domain=${t};`,t.indexOf(".")!==-1;)t=t.substring(t.indexOf(".")+1);for(document.cookie.includes("pd_test_key=pd_test_value")?(i++,console.log(`internal : ${o}`)):(s++,console.log(`external : ${o}`)),t=new URL(o).hostname;document.cookie=`pd_test_key=pd_test_value; domain=${t}; max-age=0;`,t.indexOf(".")!==-1;)t=t.substring(t.indexOf(".")+1)}else i++}return s*100/(s+i)},b=()=>{const e=document.documentElement,n={childList:!0,subtree:!0};new MutationObserver(i=>{i.forEach(a=>{a.addedNodes.forEach(o=>{o.nodeName.toLowerCase()==="input"&&o.type==="password"&&p(!0).then(async t=>{t.resFlag==="Phish"&&await w(t.resFlag,t.detectBy,t.ga,t.copied,t.script,t.extLink,t.time)})})})}).observe(e,n)};b();p(!1).then(async e=>{e.resFlag==="Phish"&&await w(e.resFlag,e.detectBy,e.ga,e.copied,e.script,e.extLink,e.time)}).catch(e=>console.error(e));
